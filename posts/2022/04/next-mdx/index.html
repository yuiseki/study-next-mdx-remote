<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>@next/mdx でも frontmatter を使いたい。。 - sitename</title><meta name="next-head-count" content="3"/><title>sitename</title><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.0/styles/tokyo-night-dark.min.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous"/><link rel="preload" href="/study-nextjs-mdx/_next/static/css/5aeb6fc8778500ab.css" as="style"/><link rel="stylesheet" href="/study-nextjs-mdx/_next/static/css/5aeb6fc8778500ab.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/study-nextjs-mdx/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/study-nextjs-mdx/_next/static/chunks/webpack-7450baf38ddf13fb.js" defer=""></script><script src="/study-nextjs-mdx/_next/static/chunks/framework-5f4595e5518b5600.js" defer=""></script><script src="/study-nextjs-mdx/_next/static/chunks/main-ba665b1cf021818a.js" defer=""></script><script src="/study-nextjs-mdx/_next/static/chunks/pages/_app-656539bf19d47e8a.js" defer=""></script><script src="/study-nextjs-mdx/_next/static/chunks/pages/posts/2022/04/next-mdx-bc933bc5c46e8eae.js" defer=""></script><script src="/study-nextjs-mdx/_next/static/lZfXY_MIbBTa4zPx-lLFP/_buildManifest.js" defer=""></script><script src="/study-nextjs-mdx/_next/static/lZfXY_MIbBTa4zPx-lLFP/_ssgManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><nav class="m-4" aria-label="breadcrumb"><ol class="breadcrumb"></ol></nav><div class="container-fluid px-5">
<h1>@next/mdx でも frontmatter を使いたい。。</h1>
<!-- -->2022-04-03<!-- -->
<h2><code>@next/mdx</code> を導入するだけで <code>.mdx</code> が扱えるようになる</h2>
<p><a href="https://nextjs.org/docs/advanced-features/using-mdx">https://nextjs.org/docs/advanced-features/using-mdx</a></p>
<pre><code class="hljs language-bash">npm i @next/mdx @mdx-js/loader
</code></pre>
<p>とやったあとに、</p>
<pre><code class="hljs language-js"><span class="hljs-comment">// next.config.js</span>

<span class="hljs-keyword">const</span> withMDX = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@next/mdx&quot;</span>)({
  <span class="hljs-attr">extension</span>: <span class="hljs-regexp">/\.mdx?$/</span>,
  <span class="hljs-attr">options</span>: {
    <span class="hljs-attr">remarkPlugins</span>: [],
    <span class="hljs-attr">rehypePlugins</span>: [],
    <span class="hljs-comment">// If you use `MDXProvider`, uncomment the following line.</span>
    <span class="hljs-comment">// providerImportSource: &quot;@mdx-js/react&quot;,</span>
  },
});
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-title function_">withMDX</span>({
  <span class="hljs-comment">// Append the default value with md extensions</span>
  <span class="hljs-attr">pageExtensions</span>: [<span class="hljs-string">&quot;ts&quot;</span>, <span class="hljs-string">&quot;tsx&quot;</span>, <span class="hljs-string">&quot;js&quot;</span>, <span class="hljs-string">&quot;jsx&quot;</span>, <span class="hljs-string">&quot;md&quot;</span>, <span class="hljs-string">&quot;mdx&quot;</span>],
});
</code></pre>
<p>と書くだけで、 <code>./pages/posts/test.mdx</code> とかが一応動くようになった。素晴らしい。</p>
<h2><code>@next/mdx</code> の罠</h2>
<p>上記の手順だけでは、 <code>frontmatter</code> が使えない。</p>
<p><code>frontmatter</code> というのは、Markdown 拡張の一種で、Markdown の先頭に YAML を書けるようにする記法。</p>
<p>こういうの</p>
<pre><code class="hljs language-md">---
title: &quot;あいうえお&quot;
<span class="hljs-section">date: &quot;2022-04-03&quot;
---</span>
</code></pre>
<p>これが使えないと結構困る。</p>
<h2><code>remark-mdx-frontmatter</code> を使う</h2>
<p>これを解決する方法がある。</p>
<pre><code class="hljs language-bash">npm i remark-frontmatter remark-mdx-frontmatter
</code></pre>
<p><strong>超重要</strong>
<strong><code>next.config.js</code> を <code>next.config.mjs</code> に rename する</strong></p>
<p><code>next.config.js</code> では <code>import</code> が使えないため。</p>
<pre><code class="hljs language-js"><span class="hljs-comment">// next.config.mjs</span>

<span class="hljs-keyword">import</span> nextMdx <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@next/mdx&quot;</span>;
<span class="hljs-keyword">import</span> remarkFrontmatter <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;remark-frontmatter&quot;</span>;
<span class="hljs-keyword">import</span> { remarkMdxFrontmatter } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;remark-mdx-frontmatter&quot;</span>;

<span class="hljs-keyword">const</span> withMDX = <span class="hljs-title function_">nextMdx</span>({
  <span class="hljs-attr">extension</span>: <span class="hljs-regexp">/\.mdx?$/</span>,
  <span class="hljs-attr">options</span>: {
    <span class="hljs-attr">remarkPlugins</span>: [
      remarkFrontmatter,
      [remarkMdxFrontmatter, { <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;frontmatter&quot;</span> }],
    ],
    <span class="hljs-attr">rehypePlugins</span>: [],
  },
});
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">withMDX</span>({
  <span class="hljs-attr">pageExtensions</span>: [<span class="hljs-string">&quot;ts&quot;</span>, <span class="hljs-string">&quot;tsx&quot;</span>, <span class="hljs-string">&quot;js&quot;</span>, <span class="hljs-string">&quot;jsx&quot;</span>, <span class="hljs-string">&quot;md&quot;</span>, <span class="hljs-string">&quot;mdx&quot;</span>],
});
</code></pre></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/posts/2022/04/next-mdx","query":{},"buildId":"lZfXY_MIbBTa4zPx-lLFP","assetPrefix":"/study-nextjs-mdx","nextExport":true,"autoExport":true,"isFallback":false,"scriptLoader":[]}</script></body></html>